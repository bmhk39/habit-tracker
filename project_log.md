# 習慣トラッカー プロジェクトログ

## プロジェクト概要

**目的**: 自分のための自己管理ツール。アプリ開発が目的ではなく、実際に使いながら育てていく。

**思想**: 「すべては習慣。安定した丁寧な生活のために。」

---

## 技術スタック

| 項目 | 技術 |
|------|------|
| フロントエンド | React + Vite |
| データベース | Firebase Firestore |
| 認証 | Firebase Authentication (Google) |
| ホスティング | Vercel |
| PWA | vite-plugin-pwa |

---

## リポジトリ・URL

- **GitHub**: https://github.com/bmhk39/habit-tracker
- **本番URL**: (Vercelにデプロイ済み)

---

## 実装済み機能 (MVP)

- [x] Googleログイン/ログアウト
- [x] 習慣の追加（作成日時を自動記録）
- [x] 習慣の編集（設定メニュー内）
- [x] 習慣の削除（設定メニュー内）
- [x] 今日の記録（✓/○ トグル）
- [x] 達成時のスナックバー通知（取り消しリンク付き）
- [x] 達成取り消し時の確認ダイアログ
- [x] PWA対応（ホーム画面に追加可能）
- [x] PC・スマホ間のデータ同期
- [x] 日付切り替え時刻の設定（0:00〜23:00）
- [x] 設定変更時の警告表示
- [x] 達成済み習慣の自動ソート（達成したら下へ移動）

---

## 意図的に作らなかった機能

以下は「欲しい」と言われるまで実装しない方針：

- ストリーク（連続達成日数）表示
- カレンダー表示
- 統計・グラフ
- 通知・リマインダー
- 習慣のカテゴリ分け
- 達成率の計算

---

## データ構造

```
users/{userId}/habits/{habitId}
  ├── name: "習慣名"
  ├── createdAt: タイムスタンプ（時刻含む）
  └── logs: {
        "2026-01-10": { 
          done: true, 
          completedAt: "2026-01-10T08:30:45+09:00" 
        },
        "2026-01-09": { done: false, completedAt: null }
      }

users/{userId}/settings/general
  └── dayStartHour: 4  // 日付切り替え時刻（0〜23）
```

---

## セッション履歴

### 2026-01-10 04:00 - 05:30

**実施内容**:
1. **iOS PWA 入力バグ修正**:
   - iOS Safari PWAモードで入力フィールドが反応しない問題を解決
   - 原因: PWAモードにおける暗黙の `user-select: none`、およびタッチイベントの扱い
   - 解決策: `index.css` にて `user-select: text !important` と `-webkit-touch-callout: default` を適用し、入力エリアの挙動を正常化

2. **PWAの更新挙動強化**:
   - `vite-plugin-pwa` の `autoUpdate` に加えて、`skipWaiting: true`, `clientsClaim: true` を明示設定
   - キャッシュによる「修正が反映されない」問題を軽減（タスクキルでの再起動を推奨）

3. **習慣の並び替え機能**:
   - ライブラリ: `@dnd-kit` (core, sortable, modifiers) 導入
   - 実装: 長押し＋ドラッグによる並び替え
   - データ構造: `order` フィールドを追加し、Firestoreで順序を永続化

4. **UXの磨き込み（ネイティブアプリライクな操作感）**:
   - **長押しセンサーの厳格化**: タッチでは250ms長押し、PC（マウス）では10px移動でドラッグ開始判定とし、誤操作（スクロールやタップ）を防止
   - **DragOverlay導入**: ドラッグ中のアイテムをリストから切り離し、リッチな視覚効果（拡大、影、不透明度調整）を実現
   - **垂直軸固定**: `restrictToVerticalAxis` で横ブレを防止し、操作感を安定化
   - **iOS対策**: ドラッグ対象アイテムに対して `WebkitTouchCallout: none`, `WebkitUserSelect: none` を適用し、長押し時の標準メニューを抑制

**次回やること**:
- 安定稼働の確認

### 2026-01-10 03:03 - 03:45

**実施内容**:
1. 達成時刻（completedAt）をログに追加
2. 設定メニュー追加（⚙ボタン）
3. 日付切り替え時刻の設定機能
   - 設定変更時の警告ダイアログ
4. スナックバー（達成通知）実装
   - 「取り消す」リンク（確認なしで即取り消し）
5. ボタン再タップ時の確認ダイアログ
6. トップ画面のシンプル化
   - 編集・削除ボタンを設定メニュー内に移動
   - 「習慣の管理」画面を新設

**学習・設計上の気づき**:
- 日付切り替え設定を変更すると、既存データの表示が変わる
- これは仕様として正しい動作だが、ユーザーに警告が必要

**次回やること**:
- 実際に使ってみて改善点を洗い出す
- 必要に応じて機能追加

---

### 2026-01-10 01:37 - 03:03

**実施内容**:
1. プロジェクトの目的・方針を確認
2. 技術選定（Firebase + Vercel + React/Vite）
3. Firebase プロジェクト作成・設定
   - Authentication（Google認証）有効化
   - Firestore データベース作成
4. Vite + React プロジェクト初期化
5. 習慣トラッカー MVP 実装
6. PWA 対応追加
7. GitHub リポジトリ作成・プッシュ
8. Vercel デプロイ
9. Firebase に Vercel ドメインを承認済みドメインに追加
10. PC・スマホ間のデータ同期を確認

---

## メモ

- Firebase の無料枠で個人利用は十分
- Vercel は商用利用不可（Hobbyプラン）、将来的に移行検討
- デザインは最小限。必要に応じて改善
- 用語集を `Antigravity/glossary.md` に作成済み
